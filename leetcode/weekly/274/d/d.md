内向基环树：拓扑排序+分类讨论+DFS

本文将介绍处理基环树问题的一些技巧。

从 $i$ 向 $\textit{favorite}[i]$ 连边，我们可以得到一张有向图。由于每个大小为 $k$ 的连通块都有 $k$ 个点和 $k$ 条边，所以每个连通块必定有且仅有一个环，且由于每个点的出度均为 $1$，这样的有向图又叫做**内向基环树（森林）**。

每一个内向基环树（连通块）都由一个**基环**和若干指向基环的**树枝**组成，例如示例 $3$ 可以得到如下内向基环树，其基环由节点 $0$、$1$、$3$ 和 $4$ 组成，节点 $2$ 为其树枝：



特别地，我们得到的基环可能只包含两个节点，例如示例 $1$ 可以得到如下内向基环树，其基环只包含节点 $1$ 和 $2$，而节点 $0$ 和 $3$ 组成其树枝：



对于本题来说，这两类基环在组成圆桌时会有明显区别，下文会说明这一点。

先来看看基环大小大于 $2$ 的情况，显然基环上的节点组成了一个环，因而可以组成一个圆桌；而树枝上的点，若插入圆桌上 $v\rightarrow w$ 这条边，会导致节点 $v$ 无法和其喜欢的员工坐在一起，因此树枝上的点是无法插入圆桌的；此外，树枝上的点也不能单独组成圆桌，因为这样会存在一个出度为 $0$ 的节点，其无法和其喜欢的员工坐在一起。对于其余内向基环树（连通块）上的节点，和树枝同理，也无法插入该基环组成的圆桌。

因此，对于基环大小大于 $2$ 的情况，圆桌的最大员工数目即为最大的基环大小，记作 $\textit{maxCycleSize}$。

下面来分析基环大小等于 $2$ 的情况。

以如下基环树为例，$0$ 和 $1$ 组成基环，其余节点组成树枝：


我们可以先让 $0$ 和 $1$ 坐在圆桌旁（假设 $0$ 坐在 $1$ 左侧），那么 $0$ 这一侧的树枝只能坐在 $0$ 的左侧，而 $1$ 这一侧的树枝只能坐在 $1$ 的右侧。

$2$ 可以紧靠着坐在 $0$ 的左侧，而 $3$ 和 $4$ 只能有一个紧靠着坐在 $2$ 的左侧（如果 $4$ 紧靠着坐在 $2$ 的左侧，那么 $3$ 是无法紧靠着坐在 $4$ 的左侧的）。

这意味着从 $0$ 出发倒着找树枝上的点（即沿着反图上的边），每个点只能在其反图上选择其中一个子节点，因此 $0$ 这一侧的节点必须组成一条链，那么我们可以找最长的那条链，即上图加粗的节点。

对于 $1$ 这一侧也同理，将这两条最长链拼起来即为该基环树能组成的圆桌的最大员工数。

对于多个基环大小等于 $2$ 的基环树，每个基环树所对应的链，都可以拼在其余链的末尾，因此我们可以将这些链全部拼成一个圆桌，其大小记作 $\textit{sumListSize}$。

答案即为 $\max(\textit{maxCycleSize},\textit{sumListSize})$。

代码实现时，可以通过一次拓扑排序「剪掉」所有树枝，然后我们遍历所有剩下的基环，按基环大小分类计算。
